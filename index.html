<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ Microsoft Office</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; font-family: 'Prompt', sans-serif; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.4); } 50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.8); } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    .float-animation { animation: float 3s ease-in-out infinite; }
    .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    .shake { animation: shake 0.5s ease-in-out; }
    .game-card { transition: all 0.3s ease; cursor: pointer; }
    .game-card:hover { transform: translateY(-8px) scale(1.02); }
    .menu-popup { transform: translateX(100%); transition: transform 0.3s ease; }
    .menu-popup.active { transform: translateX(0); }
    .modal-overlay { backdrop-filter: blur(8px); }
    .correct-answer { background: linear-gradient(135deg, #10b981, #059669) !important; color: white !important; }
    .wrong-answer { background: linear-gradient(135deg, #ef4444, #dc2626) !important; color: white !important; }
    .matching-selected { border-color: #6366f1 !important; box-shadow: 0 0 15px rgba(99, 102, 241, 0.5); }
    .matching-matched { opacity: 0.5; pointer-events: none; }
    .gradient-word { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
    .gradient-excel { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .gradient-powerpoint { background: linear-gradient(135deg, #f97316, #ea580c); }
    .tab-active { background: white; color: #6366f1; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); }
    /* Admin Styles */
    .admin-row:nth-child(even) { background-color: #f9fafb; }
    .admin-row:hover { background-color: #f3f4f6; }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-indigo-100 via-purple-50 to-pink-100 overflow-auto">
  <div id="app" class="h-full w-full">
   <header class="bg-white/80 backdrop-blur-md shadow-lg sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
     <div class="flex items-center gap-3">
      <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center float-animation"><span class="text-2xl">üéÆ</span></div>
      <h1 id="site-title" class="text-xl md:text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ Microsoft Office</h1>
     </div>
     <div class="flex items-center gap-3">
      <div id="user-info" class="hidden md:flex items-center gap-2 bg-indigo-50 px-4 py-2 rounded-full"><span class="text-indigo-600">üë§</span> <span id="user-name-display" class="text-indigo-700 font-medium"></span></div>
      <button id="menu-btn" class="p-3 hover:bg-gray-100 rounded-full transition-colors">
       <svg class="w-6 h-6 text-gray-600" fill="currentColor" viewbox="0 0 24 24"><circle cx="12" cy="5" r="2" /> <circle cx="12" cy="12" r="2" /> <circle cx="12" cy="19" r="2" /></svg>
      </button>
     </div>
    </div>
   </header>
   <div id="menu-overlay" class="fixed inset-0 bg-black/30 z-50 hidden"></div>
   <div id="menu-popup" class="menu-popup fixed right-0 top-0 h-full w-80 bg-white shadow-2xl z-50 overflow-y-auto">
    <div class="p-6">
     <div class="flex items-center justify-between mb-8">
      <h2 class="text-xl font-bold text-gray-800">‡πÄ‡∏°‡∏ô‡∏π</h2><button id="close-menu" class="p-2 hover:bg-gray-100 rounded-full transition-colors"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
     </div>
     <nav class="space-y-2">
      <button id="btn-admin" class="hidden w-full flex items-center gap-4 p-4 bg-gray-800 hover:bg-gray-700 text-white rounded-xl transition-colors text-left mb-4 shadow-lg"><div class="w-10 h-10 bg-gray-600 rounded-lg flex items-center justify-center">üõ†Ô∏è</div><span class="font-medium">‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (Admin)</span></button>
      <button id="btn-register" class="w-full flex items-center gap-4 p-4 hover:bg-indigo-50 rounded-xl transition-colors text-left"><div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center"><span class="text-xl">üìù</span></div><span class="font-medium text-gray-700">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span> </button> 
      <button id="btn-login" class="w-full flex items-center gap-4 p-4 hover:bg-green-50 rounded-xl transition-colors text-left"><div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center"><span class="text-xl">üîë</span></div><span class="font-medium text-gray-700">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span> </button> 
      <button id="btn-history" class="w-full flex items-center gap-4 p-4 hover:bg-purple-50 rounded-xl transition-colors text-left"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center"><span class="text-xl">üìä</span></div><span class="font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</span> </button> 
      <button id="btn-how-to-play" class="w-full flex items-center gap-4 p-4 hover:bg-blue-50 rounded-xl transition-colors text-left"><div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center"><span class="text-xl">üìñ</span></div><span class="font-medium text-gray-700">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</span> </button> 
      <button id="btn-developer" class="w-full flex items-center gap-4 p-4 hover:bg-pink-50 rounded-xl transition-colors text-left"><div class="w-10 h-10 bg-pink-100 rounded-lg flex items-center justify-center"><span class="text-xl">üë©‚Äçüíª</span></div><span class="font-medium text-gray-700">‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏Å‡∏°</span> </button> 
      <button id="btn-logout" class="w-full flex items-center gap-4 p-4 hover:bg-red-50 rounded-xl transition-colors text-left hidden"><div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center"><span class="text-xl">üö™</span></div><span class="font-medium text-red-600">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span> </button>
     </nav>
    </div>
   </div>
   <main class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex justify-center mb-8">
     <div class="bg-white/50 backdrop-blur rounded-2xl p-2 inline-flex gap-2">
        <button class="category-tab tab-active px-6 py-3 rounded-xl font-medium transition-all" data-category="word"> üìò Word </button> 
        <button class="category-tab px-6 py-3 rounded-xl font-medium transition-all text-gray-600 hover:bg-white/50" data-category="excel"> üìó Excel </button> 
        <button class="category-tab px-6 py-3 rounded-xl font-medium transition-all text-gray-600 hover:bg-white/50" data-category="powerpoint"> üìô PowerPoint </button>
     </div>
    </div>
    <div id="games-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
   </main>
   <footer class="bg-white/80 backdrop-blur-md mt-12 py-8">
    <div class="max-w-7xl mx-auto px-4 text-center">
     <div class="flex items-center justify-center gap-2 mb-4"><span class="text-2xl">üè´</span>
      <p id="footer-text" class="text-gray-600 font-medium">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à &amp; ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</p>
     </div>
     <p class="text-sm text-gray-400">¬© 2024 Microsoft Office Skills Training Game</p>
    </div>
   </footer>
  </div>
  <div id="modals-container"></div>
  <script>
    // ==================== Game Data ====================
    const gameData = {
      word: {
        name: 'Microsoft Word', icon: 'üìò', gradient: 'gradient-word',
        typing: [{ word: 'DOCUMENT', hint: 'D_C_M_NT', answer: 'DOCUMENT', desc: '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£' }, { word: 'PARAGRAPH', hint: 'P_R_GR_PH', answer: 'PARAGRAPH', desc: '‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤' }, { word: 'FONT', hint: 'F_NT', answer: 'FONT', desc: '‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏Å‡∏©‡∏£' }, { word: 'MARGIN', hint: 'M_RG_N', answer: 'MARGIN', desc: '‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏ö' }, { word: 'HEADER', hint: 'H_ _D_R', answer: 'HEADER', desc: '‡∏´‡∏±‡∏ß‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©' }],
        quiz: [{ q: '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á Microsoft Word ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?', choices: ['.docx', '.xlsx', '.pptx', '.pdf'], answer: 0 }, { q: '‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î Ctrl+B ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?', choices: ['‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ', '‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤', '‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏µ‡∏¢‡∏á', '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å'], answer: 1 }, { q: '‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏î‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©?', choices: ['Home', 'Insert', 'Layout', 'View'], answer: 2 }, { q: 'Ctrl+S ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö?', choices: ['‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', '‡∏û‡∏¥‡∏°‡∏û‡πå'], answer: 1 }],
        matching: [{ left: 'üìÑ', right: 'Document', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£' }, { left: 'üî§', right: 'Font', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏≠‡∏ô‡∏ï‡πå' }, { left: 'üìã', right: 'Clipboard', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î' }, { left: 'üñ®Ô∏è', right: 'Print', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå' }],
        scenario: [{ title: '‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà', steps: ['‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° Word', '‡∏Ñ‡∏•‡∏¥‡∏Å File', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å New', '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå'] }, { title: '‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå', steps: ['‡∏Ñ‡∏•‡∏¥‡∏Å File', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Save As', '‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå', '‡∏Ñ‡∏•‡∏¥‡∏Å Save'] }]
      },
      excel: {
        name: 'Microsoft Excel', icon: 'üìó', gradient: 'gradient-excel',
        typing: [{ word: 'CELL', hint: 'C_LL', answer: 'CELL', desc: '‡πÄ‡∏ã‡∏•‡∏•‡πå' }, { word: 'FORMULA', hint: 'F_RM_LA', answer: 'FORMULA', desc: '‡∏™‡∏π‡∏ï‡∏£' }, { word: 'WORKSHEET', hint: 'W_RKS_ _ET', answer: 'WORKSHEET', desc: '‡πÅ‡∏ú‡πà‡∏ô‡∏á‡∏≤‡∏ô' }, { word: 'CHART', hint: 'CH_RT', answer: 'CHART', desc: '‡πÅ‡∏ú‡∏ô‡∏†‡∏π‡∏°‡∏¥' }],
        quiz: [{ q: '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á Excel ‡∏Ñ‡∏∑‡∏≠?', choices: ['.docx', '.xlsx', '.pptx', '.txt'], answer: 1 }, { q: '‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô SUM ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£?', choices: ['‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', '‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢', '‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤', '‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î'], answer: 2 }, { q: '‡πÄ‡∏ã‡∏•‡∏•‡πå A1 ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á?', choices: ['‡πÅ‡∏ñ‡∏ß A ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 1', '‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A ‡πÅ‡∏ñ‡∏ß 1', '‡∏´‡∏ô‡πâ‡∏≤ A ‡∏Ç‡πâ‡∏≠ 1', '‡πÑ‡∏ü‡∏•‡πå A ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ 1'], answer: 1 }],
        matching: [{ left: 'üìä', right: 'Chart', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ú‡∏ô‡∏†‡∏π‡∏°‡∏¥' }, { left: 'üî¢', right: 'Number', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç' }, { left: 'üìà', right: 'Graph', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏≤‡∏ü' }, { left: 'üßÆ', right: 'Calculate', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì' }],
        scenario: [{ title: '‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡∏ö‡∏ß‡∏Å', steps: ['‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡∏•‡πå', '‡∏û‡∏¥‡∏°‡∏û‡πå =', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÅ‡∏£‡∏Å', '‡∏Å‡∏î Enter'] }, { title: '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô SUM', steps: ['‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡∏•‡πå', '‡∏û‡∏¥‡∏°‡∏û‡πå =SUM(', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏õ‡∏¥‡∏î‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡πÅ‡∏•‡∏∞ Enter'] }]
      },
      powerpoint: {
        name: 'Microsoft PowerPoint', icon: 'üìô', gradient: 'gradient-powerpoint',
        typing: [{ word: 'SLIDE', hint: 'SL_D_', answer: 'SLIDE', desc: '‡∏™‡πÑ‡∏•‡∏î‡πå' }, { word: 'ANIMATION', hint: 'AN_M_T_ _N', answer: 'ANIMATION', desc: '‡∏†‡∏≤‡∏û‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß' }, { word: 'TRANSITION', hint: 'TR_NS_T_ _N', answer: 'TRANSITION', desc: '‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡πÑ‡∏•‡∏î‡πå' }],
        quiz: [{ q: '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå PowerPoint ‡∏Ñ‡∏∑‡∏≠?', choices: ['.docx', '.xlsx', '.pptx', '.pdf'], answer: 2 }, { q: 'F5 ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö?', choices: ['‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠', '‡∏û‡∏¥‡∏°‡∏û‡πå', '‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå'], answer: 1 }, { q: 'Transition ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?', choices: ['‡∏†‡∏≤‡∏û‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏', '‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡πÑ‡∏•‡∏î‡πå', '‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ', '‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ü‡∏≠‡∏ô‡∏ï‡πå'], answer: 1 }],
        matching: [{ left: 'üé¨', right: 'Animation', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô' }, { left: 'üñºÔ∏è', right: 'Slide', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏™‡πÑ‡∏•‡∏î‡πå' }, { left: 'üé®', right: 'Design', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö' }, { left: '‚ñ∂Ô∏è', right: 'Play', leftLabel: '‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô' }],
        scenario: [{ title: '‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÉ‡∏´‡∏°‡πà', steps: ['‡πÄ‡∏õ‡∏¥‡∏î PowerPoint', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Template', '‡πÉ‡∏™‡πà‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠', '‡∏Ñ‡∏•‡∏¥‡∏Å Create'] }, { title: '‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏•‡∏î‡πå‡πÉ‡∏´‡∏°‡πà', steps: ['‡∏Ñ‡∏•‡∏¥‡∏Å Home', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å New Slide', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Layout', '‡πÉ‡∏™‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤'] }]
      }
    };

    // ==================== State Management ====================
    let currentUser = null;
    let isAdmin = false;
    let allData = [];
    let currentCategory = 'word';
    let currentGame = null;
    let gameState = {};

    // ==================== Default Config ====================
    const defaultConfig = {
      site_title: '‡πÄ‡∏Å‡∏°‡∏ù‡∏∂‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞ Microsoft Office',
      footer_text: '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à & ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•'
    };
    let config = { ...defaultConfig };

    // ==================== SDK & Logic ====================
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        checkLoginStatus();
      }
    };

    function checkLoginStatus() {
      const savedEmail = localStorage.getItem('currentUserEmail');
      const savedType = localStorage.getItem('userType');
      
      if(savedType === 'admin') {
          isAdmin = true;
          currentUser = { name: 'Admin', email: 'admin@system.com' };
          updateUIForLoggedIn();
      } else if (savedEmail) {
        const user = allData.find(d => d.user_type === 'user' && d.email === savedEmail);
        if (user) {
          currentUser = user;
          updateUIForLoggedIn();
        }
      }
    }

    function updateUIForLoggedIn() {
      if (currentUser) {
        document.getElementById('user-info').classList.remove('hidden');
        document.getElementById('user-name-display').textContent = currentUser.name;
        document.getElementById('btn-register').classList.add('hidden');
        document.getElementById('btn-login').classList.add('hidden');
        document.getElementById('btn-logout').classList.remove('hidden');
        if(isAdmin) document.getElementById('btn-admin').classList.remove('hidden');
      }
    }

    async function initElementSdk() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => { config = { ...config, ...newConfig }; document.getElementById('site-title').textContent = config.site_title; },
          mapToCapabilities: (cfg) => ({ recolorables: [], borderables: [] })
        });
      }
    }

    // ==================== Admin System ====================
    function showAdminDashboard() {
        // Prepare Data
        const users = allData.filter(d => d.user_type === 'user');
        const history = allData.filter(d => d.user_type === 'history');
        const sortedHistory = [...history].sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));
        const sortedUsers = [...users].sort((a,b) => new Date(b.created_at || 0) - new Date(a.created_at || 0));

        const content = `
            <div class="p-6 h-full flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üõ†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (Admin)</h2>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-red-500">‚ùå ‡∏õ‡∏¥‡∏î</button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-indigo-100 p-4 rounded-xl">
                        <div class="text-indigo-600 text-sm font-bold">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="text-3xl font-bold text-indigo-800">${users.length} ‡∏Ñ‡∏ô</div>
                    </div>
                    <div class="bg-green-100 p-4 rounded-xl">
                        <div class="text-green-600 text-sm font-bold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</div>
                        <div class="text-3xl font-bold text-green-800">${history.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-xl">
                        <div class="text-purple-600 text-sm font-bold">‡πÄ‡∏Å‡∏°‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</div>
                        <div class="text-3xl font-bold text-purple-800">${getMostPopularGame(history)}</div>
                    </div>
                </div>

                <div class="flex gap-2 mb-4 border-b">
                    <button onclick="switchAdminTab('users')" id="tab-users" class="px-4 py-2 font-medium text-indigo-600 border-b-2 border-indigo-600">üë§ ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                    <button onclick="switchAdminTab('history')" id="tab-history" class="px-4 py-2 font-medium text-gray-500 hover:text-indigo-600">üìä ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</button>
                </div>

                <div id="admin-view-users" class="overflow-y-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-100 text-gray-600 text-sm">
                                <th class="p-3 rounded-tl-lg">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th>
                                <th class="p-3">‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th class="p-3 rounded-tr-lg">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedUsers.map(u => `
                                <tr class="admin-row border-b border-gray-100">
                                    <td class="p-3 text-sm text-gray-500">${formatDate(u.created_at)}</td>
                                    <td class="p-3 font-medium text-gray-800">${u.name}</td>
                                    <td class="p-3 text-gray-600">${u.email}</td>
                                </tr>
                            `).join('') || '<tr><td colspan="3" class="p-4 text-center text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</td></tr>'}
                        </tbody>
                    </table>
                </div>

                <div id="admin-view-history" class="hidden overflow-y-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-100 text-gray-600 text-sm">
                                <th class="p-3 rounded-tl-lg">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πà‡∏ô</th>
                                <th class="p-3">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
                                <th class="p-3">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                <th class="p-3">‡πÇ‡∏´‡∏°‡∏î</th>
                                <th class="p-3 rounded-tr-lg">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedHistory.map(h => `
                                <tr class="admin-row border-b border-gray-100">
                                    <td class="p-3 text-sm text-gray-500">${formatDate(h.timestamp)}</td>
                                    <td class="p-3 font-medium text-gray-800">${h.user_name || 'Unknown'}</td>
                                    <td class="p-3"><span class="px-2 py-1 rounded text-xs bg-gray-200">${h.category}</span></td>
                                    <td class="p-3 text-sm">${h.mode}</td>
                                    <td class="p-3 font-bold text-indigo-600">${h.score}</td>
                                </tr>
                            `).join('') || '<tr><td colspan="5" class="p-4 text-center text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</td></tr>'}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
        showGameModal(content, 'admin-modal');
        closeMenu();
    }

    function switchAdminTab(tab) {
        document.getElementById('admin-view-users').classList.add('hidden');
        document.getElementById('admin-view-history').classList.add('hidden');
        document.getElementById('tab-users').className = "px-4 py-2 font-medium text-gray-500 hover:text-indigo-600";
        document.getElementById('tab-history').className = "px-4 py-2 font-medium text-gray-500 hover:text-indigo-600";
        
        document.getElementById(`admin-view-${tab}`).classList.remove('hidden');
        document.getElementById(`tab-${tab}`).className = "px-4 py-2 font-medium text-indigo-600 border-b-2 border-indigo-600";
    }

    function formatDate(isoString) {
        if(!isoString) return '-';
        return new Date(isoString).toLocaleString('th-TH', { dateStyle: 'medium', timeStyle: 'short' });
    }

    function getMostPopularGame(history) {
        if(history.length === 0) return '-';
        const counts = {};
        history.forEach(h => { counts[h.category] = (counts[h.category] || 0) + 1; });
        return Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
    }

    // ==================== Modals & Auth ====================
    function showModal(content, id = 'modal') {
      const container = document.getElementById('modals-container');
      container.innerHTML = `<div id="${id}" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/50"><div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full max-h-[90%] overflow-y-auto animate-in">${content}</div></div>`;
      document.getElementById(id).addEventListener('click', (e) => { if (e.target.id === id) closeModal(); });
    }
    
    function showGameModal(content, id = 'game-modal') {
      document.getElementById('modals-container').innerHTML = `<div id="${id}" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/50"><div class="bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90%] overflow-y-auto h-[600px]">${content}</div></div>`;
    }

    function closeModal() { document.getElementById('modals-container').innerHTML = ''; }

    // Register Logic (Completed)
    function showRegisterModal() {
        const content = `
            <div class="p-8">
                <div class="text-center mb-6"><span class="text-5xl mb-3 block">üìù</span><h2 class="text-2xl font-bold text-gray-800">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2></div>
                <form id="register-form" class="space-y-4">
                    <input type="email" id="reg-email" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                    <input type="text" id="reg-name" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                    <input type="password" id="reg-password" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                    <div id="reg-error" class="hidden text-red-500 text-sm text-center"></div>
                    <button type="submit" id="reg-btn" class="w-full py-4 bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold rounded-xl">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                </form>
            </div>`;
        showModal(content);
        closeMenu();
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('reg-email').value.trim();
            const name = document.getElementById('reg-name').value.trim();
            const password = document.getElementById('reg-password').value;
            const errorDiv = document.getElementById('reg-error');
            const btn = document.getElementById('reg-btn');

            if (allData.find(d => d.user_type === 'user' && d.email === email)) {
                errorDiv.textContent = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß'; errorDiv.classList.remove('hidden'); return;
            }

            btn.disabled = true; btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            // Save with CREATED_AT (Registration Date)
            await window.dataSdk.create({ 
                user_type: 'user', email, name, password, 
                created_at: new Date().toISOString() 
            });
            
            closeModal();
            alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
        });
    }

    // Login Logic
    function showLoginModal() {
        const content = `
            <div class="p-8">
                <div class="text-center mb-6"><span class="text-5xl mb-3 block">üîë</span><h2 class="text-2xl font-bold text-gray-800">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2></div>
                <form id="login-form" class="space-y-4">
                    <input type="email" id="login-email" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                    <input type="password" id="login-password" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                    <div id="login-error" class="hidden text-red-500 text-sm text-center"></div>
                    <button type="submit" class="w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-xl">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                </form>
            </div>`;
        showModal(content);
        closeMenu();
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');

            // Admin Check
            if(email === 'admin@system.com' && password === 'admin') {
                localStorage.setItem('userType', 'admin');
                localStorage.setItem('currentUserEmail', email);
                isAdmin = true;
                currentUser = { name: 'Admin', email };
                closeModal();
                updateUIForLoggedIn();
                showAdminDashboard();
                return;
            }

            const user = allData.find(d => d.user_type === 'user' && d.email === email && d.password === password);
            if (user) {
                localStorage.setItem('userType', 'user');
                localStorage.setItem('currentUserEmail', email);
                currentUser = user;
                closeModal();
                updateUIForLoggedIn();
            } else {
                errorDiv.textContent = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'; errorDiv.classList.remove('hidden');
            }
        });
    }

    function handleLogout() {
        localStorage.removeItem('currentUserEmail');
        localStorage.removeItem('userType');
        currentUser = null;
        isAdmin = false;
        document.getElementById('user-info').classList.add('hidden');
        document.getElementById('btn-register').classList.remove('hidden');
        document.getElementById('btn-login').classList.remove('hidden');
        document.getElementById('btn-logout').classList.add('hidden');
        document.getElementById('btn-admin').classList.add('hidden');
        closeMenu();
    }

    // ==================== Game Logic ====================
    function renderGames() {
        const container = document.getElementById('games-container');
        const data = gameData[currentCategory];
        
        const games = [
            { id: 'typing', name: '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå', icon: '‚å®Ô∏è', desc: '‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ' },
            { id: 'quiz', name: '‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°', icon: '‚ùì', desc: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' },
            { id: 'matching', name: '‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô', icon: 'üîó', desc: '‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏†‡∏≤‡∏û‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢' },
            { id: 'scenario', name: '‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå', icon: 'üìã', desc: '‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô' }
        ];

        container.innerHTML = games.map(g => `
            <div onclick="startGame('${g.id}')" class="game-card bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-xl relative overflow-hidden group">
                <div class="absolute right-0 top-0 w-32 h-32 bg-${data.gradient} opacity-10 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                <div class="flex items-start gap-4 relative z-10">
                    <div class="w-16 h-16 rounded-xl bg-gray-50 flex items-center justify-center text-3xl shadow-inner">${g.icon}</div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1">${g.name}</h3>
                        <p class="text-gray-500 text-sm">${g.desc}</p>
                        <span class="inline-block mt-3 text-xs font-semibold px-3 py-1 bg-gray-100 text-gray-600 rounded-full group-hover:bg-indigo-600 group-hover:text-white transition-colors">‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢ ‚Üí</span>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function startGame(mode) {
        if (!currentUser && !isAdmin) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°'); return; }
        
        currentGame = { mode, score: 0, currentIdx: 0, items: [...gameData[currentCategory][mode]] };
        // Shuffle items for randomness if needed
        if(mode !== 'scenario') currentGame.items.sort(() => Math.random() - 0.5); 
        
        renderGameModal(mode);
    }

    function renderGameModal(mode) {
        let content = '';
        const item = currentGame.items[currentGame.currentIdx];
        const progress = `${currentGame.currentIdx + 1}/${currentGame.items.length}`;

        if (!item) { endGame(); return; }

        if (mode === 'typing') {
            content = `
                <div class="p-8 text-center">
                    <div class="mb-4 flex justify-between"><span class="bg-gray-100 px-3 py-1 rounded-full text-sm">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${progress}</span><span class="text-indigo-600 font-bold">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${currentGame.score}</span></div>
                    <div class="text-6xl mb-6 shake">${gameData[currentCategory].icon}</div>
                    <h3 class="text-2xl font-bold mb-2">${item.desc}</h3>
                    <div class="text-4xl font-mono text-indigo-500 tracking-widest mb-8 font-bold">${item.hint}</div>
                    <input type="text" id="game-input" class="w-full text-center text-2xl p-4 border-b-4 border-indigo-100 focus:border-indigo-500 outline-none uppercase" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö..." autocomplete="off">
                    <button onclick="checkAnswer('${mode}')" class="mt-8 w-full py-4 bg-indigo-600 text-white rounded-xl font-bold text-xl hover:bg-indigo-700">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
                </div>`;
        } else if (mode === 'quiz') {
            content = `
                <div class="p-8">
                    <div class="mb-6 flex justify-between"><span class="bg-gray-100 px-3 py-1 rounded-full text-sm">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${progress}</span><span class="text-indigo-600 font-bold">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${currentGame.score}</span></div>
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center leading-relaxed">${item.q}</h3>
                    <div class="grid gap-3">
                        ${item.choices.map((c, i) => `<button onclick="checkAnswer('${mode}', ${i})" class="p-4 text-left border-2 border-gray-100 rounded-xl hover:border-indigo-500 hover:bg-indigo-50 transition-all font-medium">${c}</button>`).join('')}
                    </div>
                </div>`;
        } else if (mode === 'matching') {
            // Logic for matching render
             content = `
                <div class="p-8 h-full flex flex-col">
                     <div class="mb-4 flex justify-between"><span class="bg-gray-100 px-3 py-1 rounded-full text-sm">‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà ${progress}</span><span class="text-indigo-600 font-bold">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${currentGame.score}</span></div>
                     <div class="text-center mb-6"><div class="text-6xl mb-2">${item.left}</div><p class="text-gray-500">‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£?</p></div>
                     <div class="grid grid-cols-2 gap-4">
                        ${currentGame.items.map(i => `<button onclick="checkAnswer('matching', '${i.right}', '${item.right}')" class="p-6 bg-gray-50 rounded-xl hover:bg-indigo-50 border-2 border-transparent hover:border-indigo-200 font-bold text-gray-700">${i.right}</button>`).sort(() => Math.random() - 0.5).join('')}
                     </div>
                </div>`;
        } else if (mode === 'scenario') {
             content = `
                <div class="p-8">
                    <div class="mb-4 flex justify-between"><span class="bg-gray-100 px-3 py-1 rounded-full text-sm">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${progress}</span><span class="text-indigo-600 font-bold">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${currentGame.score}</span></div>
                    <h3 class="text-xl font-bold mb-4 text-center">‡∏à‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö: ${item.title}</h3>
                    <div id="drag-area" class="space-y-2">
                        ${[...item.steps].sort(() => Math.random() - 0.5).map((s, i) => `
                            <div class="draggable p-4 bg-white border-2 border-gray-200 rounded-xl cursor-move shadow-sm flex items-center gap-3" draggable="true">
                                <span class="text-gray-400">::</span> ${s}
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="checkAnswer('scenario')" class="mt-6 w-full py-3 bg-indigo-600 text-white rounded-xl font-bold">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡∏≥‡∏î‡∏±‡∏ö</button>
                </div>`;
                setTimeout(initDragAndDrop, 100);
        }

        showGameModal(content);
        if(mode === 'typing') document.getElementById('game-input').focus();
    }

    function checkAnswer(mode, input, answer) {
        const item = currentGame.items[currentGame.currentIdx];
        let isCorrect = false;

        if (mode === 'typing') {
            const val = document.getElementById('game-input').value.toUpperCase();
            isCorrect = val === item.answer;
        } else if (mode === 'quiz') {
            isCorrect = input === item.answer;
        } else if (mode === 'matching') {
            isCorrect = input === answer;
        } else if (mode === 'scenario') {
            const els = document.querySelectorAll('.draggable');
            const currentOrder = Array.from(els).map(e => e.innerText.replace(':: ', '').trim());
            isCorrect = JSON.stringify(currentOrder) === JSON.stringify(item.steps);
        }

        if (isCorrect) {
            currentGame.score++;
            const feedback = document.createElement('div');
            feedback.className = 'fixed inset-0 flex items-center justify-center z-[60] pointer-events-none';
            feedback.innerHTML = `<div class="bg-green-500 text-white px-8 py-4 rounded-full text-2xl font-bold animate-bounce shadow-lg">‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! üéâ</div>`;
            document.body.appendChild(feedback);
            setTimeout(() => feedback.remove(), 1000);
        } else {
             // Shake effect handled by css class toggle if needed
        }

        currentGame.currentIdx++;
        setTimeout(() => renderGameModal(mode), 500);
    }

    // Drag and Drop Logic
    function initDragAndDrop() {
        const draggables = document.querySelectorAll('.draggable');
        const container = document.getElementById('drag-area');
        
        draggables.forEach(draggable => {
            draggable.addEventListener('dragstart', () => { draggable.classList.add('dragging'); });
            draggable.addEventListener('dragend', () => { draggable.classList.remove('dragging'); });
        });

        container.addEventListener('dragover', e => {
            e.preventDefault();
            const afterElement = getDragAfterElement(container, e.clientY);
            const draggable = document.querySelector('.dragging');
            if (afterElement == null) { container.appendChild(draggable); } 
            else { container.insertBefore(draggable, afterElement); }
        });
    }

    function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.draggable:not(.dragging)')];
        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) return { offset: offset, element: child };
            else return closest;
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    async function endGame() {
        const content = `
            <div class="p-8 text-center flex flex-col items-center justify-center h-full">
                <div class="text-6xl mb-4">üèÜ</div>
                <h2 class="text-3xl font-bold text-gray-800 mb-2">‡∏à‡∏ö‡πÄ‡∏Å‡∏°!</h2>
                <p class="text-gray-500 mb-6">‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å</p>
                <div class="text-6xl font-bold text-indigo-600 mb-8">${currentGame.score} <span class="text-2xl text-gray-400">/ ${currentGame.items.length}</span></div>
                <button onclick="closeModal()" class="px-8 py-3 bg-gray-100 hover:bg-gray-200 rounded-xl font-bold text-gray-700 transition-colors">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            </div>`;
        showGameModal(content);

        // Save Score Logic
        if (currentUser) {
            await window.dataSdk.create({
                user_type: 'history',
                user_email: currentUser.email,
                user_name: currentUser.name,
                category: currentCategory,
                mode: currentGame.mode,
                score: currentGame.score,
                timestamp: new Date().toISOString()
            });
        }
    }

    // ==================== Init ====================
    // Tabs
    document.querySelectorAll('.category-tab').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.category-tab').forEach(b => {
                b.classList.remove('tab-active');
                b.classList.add('text-gray-600', 'hover:bg-white/50');
            });
            btn.classList.add('tab-active');
            btn.classList.remove('text-gray-600', 'hover:bg-white/50');
            currentCategory = btn.dataset.category;
            renderGames();
        });
    });

    // Menu Handlers
    const menuBtn = document.getElementById('menu-btn');
    const closeMenuBtn = document.getElementById('close-menu');
    const menuPopup = document.getElementById('menu-popup');
    const menuOverlay = document.getElementById('menu-overlay');

    function toggleMenu() {
        const isActive = menuPopup.classList.contains('active');
        if (isActive) closeMenu(); else openMenu();
    }
    function openMenu() { menuPopup.classList.add('active'); menuOverlay.classList.remove('hidden'); }
    function closeMenu() { menuPopup.classList.remove('active'); menuOverlay.classList.add('hidden'); }

    menuBtn.addEventListener('click', toggleMenu);
    closeMenuBtn.addEventListener('click', closeMenu);
    menuOverlay.addEventListener('click', closeMenu);

    // Button Bindings
    document.getElementById('btn-register').addEventListener('click', showRegisterModal);
    document.getElementById('btn-login').addEventListener('click', showLoginModal);
    document.getElementById('btn-admin').addEventListener('click', showAdminDashboard); // Admin Btn
    document.getElementById('btn-logout').addEventListener('click', handleLogout);
    document.getElementById('btn-how-to-play').addEventListener('click', () => {
         const content = `<div class="p-6">
            <h2 class="text-2xl font-bold mb-4">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</h2>
            <ul class="space-y-3 text-gray-600">
                <li>1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Word, Excel, PowerPoint)</li>
                <li>2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</li>
                <li>3. ‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î!</li>
            </ul>
            <button onclick="closeModal()" class="mt-6 w-full py-3 bg-indigo-600 text-white rounded-xl">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
         </div>`;
         showModal(content);
         closeMenu();
    });
    
    // Developer Modal
    document.getElementById('btn-developer').addEventListener('click', () => {
         const content = `<div class="p-6 text-center">
            <span class="text-4xl">üë©‚Äçüíª</span>
            <h2 class="text-xl font-bold mt-2">‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤</h2>
            <p class="text-gray-600 mt-2">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à<br>‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ</p>
         </div>`;
         showModal(content);
         closeMenu();
    });

    document.getElementById('btn-history').addEventListener('click', () => {
        if(!currentUser) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'); return; }
        const history = allData.filter(d => d.user_type === 'history' && d.user_email === currentUser.email)
            .sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        const content = `
            <div class="p-6 h-full flex flex-col">
                <h2 class="text-2xl font-bold mb-4">üìä ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                <div class="overflow-y-auto flex-1">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 text-gray-500"><tr><th class="p-3">‡πÄ‡∏ß‡∏•‡∏≤</th><th class="p-3">‡πÄ‡∏Å‡∏°</th><th class="p-3">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr></thead>
                        <tbody>
                            ${history.map(h => `
                                <tr class="border-b">
                                    <td class="p-3 text-sm text-gray-500">${formatDate(h.timestamp)}</td>
                                    <td class="p-3 font-medium text-indigo-600">${h.category.toUpperCase()} - ${h.mode}</td>
                                    <td class="p-3 font-bold">${h.score}</td>
                                </tr>
                            `).join('') || '<tr><td colspan="3" class="p-4 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</td></tr>'}
                        </tbody>
                    </table>
                </div>
            </div>`;
        showGameModal(content);
        closeMenu();
    });

    // Start
    renderGames();
    initElementSdk();
    
    // Initial data load simulation
    window.dataSdk = window.dataSdk || {
        create: async (data) => { 
            const newObj = {...data, _id: Date.now().toString()};
            allData.push(newObj); 
            dataHandler.onDataChanged(allData);
            return newObj;
        }
    };
    // If running in SDK environment, this will trigger updates
  </script>
 </body>
</html>